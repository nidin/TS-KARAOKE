var nid;
(function(f){(function(b){var f=function(){function a(){}a.allocateUint8=function(e){a.u8=new Uint8Array(e)};a.allocateUint16=function(e){a.u16=new Uint16Array(e)};a.allocateUint32=function(e){a.u32=new Uint32Array(e)};a.getUint8=function(){a.u8||a.allocateUint8(10);return a.u8Index++};a.getUint16=function(){a.u16||a.allocateUint16(24);return a.u16Index++};a.getUint32=function(){a.u32||a.allocateUint32(10);return a.u32Index++};a.allocateInt8=function(e){a.i8=new Int8Array(e)};a.allocateInt16=function(e){a.i16=
new Int16Array(e)};a.allocateInt32=function(e){a.i32=new Int32Array(e)};a.getInt8=function(){a.i8||a.allocateInt8(10);return a.i8Index++};a.getInt16=function(){a.i16||a.allocateInt16(24);return a.i16Index++};a.getInt32=function(){a.i32||a.allocateInt32(10);return a.i32Index++};a.allocateFloat32=function(e){a.f32=new Float32Array(e)};a.allocateFloat64=function(e){a.f64=new Float64Array(e)};a.getFloat32=function(){a.f32||a.allocateFloat32(10);return a.f32Index++};a.getFloat64=function(){a.f64||a.allocateFloat64(10);
return a.f64Index++};a.u8Index=0;a.u16Index=0;a.u32Index=0;a.i8Index=0;a.i16Index=0;a.i32Index=0;a.f32Index=0;a.f64Index=0;return a}();b.MEMORY=f})(f.utils||(f.utils={}))})(nid||(nid={}));
(function(f){var b=f.utils.MEMORY,k=function(){function a(a){this.EOF="EndOfFile";this.SC_MASK=63;this.CDG_CMD=9;this.MEMORY_PRESET=1;this.BORDER_PRESET=2;this.TILE_BLOCK_NORMAL=6;this.TILE_BLOCK_XOR=38;this.SCROLL_PRESET=20;this.SCROLL_COPY=24;this.DEFINE_TRANSPARENT_COLOR=28;this.LOAD_COLOR_TABLE_LO=30;this.LOAD_COLOR_TABLE_HIGH=31;this.WIDTH=320;this.HEIGHT=216;this.currentPos=-1;this.speed=1;this.type=b.getUint8();this.SC_MASK=b.getUint8();this.CDG_CMD=b.getUint8();this.C=b.getUint32();this.C0=
b.getUint32();this.C1=b.getUint32();this.ROW=b.getUint32();this.COL=b.getUint32();this.SCANL=b.getUint32();b.u8[this.SC_MASK]=63;b.u8[this.CDG_CMD]=9;this.canvas=a;this.context=a.getContext("2d");this.imageData=this.context.createImageData(this.WIDTH,this.HEIGHT);this.bitmapData=this.imageData.data;this.colorTable=[]}a.prototype.loadBytes=function(a){this.bytes=a;this.lastRanderdPosition=this.currentPacket=this.currentPos=0;this.pixelColorIndex=[];this.ready=!0};a.prototype.render=function(a,b){a*=
this.speed;this.context.clearRect(0,0,this.WIDTH,this.HEIGHT);for(var c=0;c<this.HEIGHT;c++)for(var d=0;d<this.WIDTH;d++){var g=this.colorTable[this.pixelColorIndex[c*this.WIDTH+d]];g&&(this.bitmapData[4*(this.WIDTH*c+d)]=g[0],this.bitmapData[4*(this.WIDTH*c+d)+1]=g[1],this.bitmapData[4*(this.WIDTH*c+d)+2]=g[2],this.bitmapData[4*(this.WIDTH*c+d)+3]=255)}c=this.currentPos>a?this.currentPacket=0:this.currentPos;for(;c<a;c++)this.draw();this.currentPos=a;this.context.putImageData(this.imageData,0,0)};
a.prototype.setSize=function(a,b){this.width=a;this.height=b};a.prototype.draw=function(){var a=24*this.currentPacket;this.currentPacket++;if(a>this.bytes.length)return console.log(this.EOF),!1;if((this.bytes[a]&b.u8[this.SC_MASK])==b.u8[this.CDG_CMD])switch(b.u8[this.type]=this.bytes[a+1]&b.u8[this.SC_MASK],b.u8[this.type]){case this.MEMORY_PRESET:0==(this.bytes[a+5]&15)&&this.clear(this.bytes[a+4]&15);break;case this.TILE_BLOCK_NORMAL:case this.TILE_BLOCK_XOR:b.u32[this.C0]=this.bytes[a+4]&15;b.u32[this.C1]=
this.bytes[a+5]&15;for(var h=12*(this.bytes[a+6]&31),c=6*(this.bytes[a+7]&b.u8[this.SC_MASK]),d=0;12>d;d++){b.u32[this.SCANL]=this.bytes[a+8+d]&b.u8[this.SC_MASK];for(var g=0;6>g;g++)b.u32[this.C]=b.u32[this.SCANL]&1?b.u32[this.C1]:b.u32[this.C0],b.u8[this.type]==this.TILE_BLOCK_XOR&&(b.u32[this.C]^=this.pixelColorIndex[c+(5-g)+(h+d)*this.WIDTH]),this.pixelColorIndex[c+(5-g)+(h+d)*this.WIDTH]=b.u32[this.C],b.u32[this.SCANL]>>=1}break;case this.LOAD_COLOR_TABLE_LO:case this.LOAD_COLOR_TABLE_HIGH:for(h=
b.u8[this.type]==this.LOAD_COLOR_TABLE_HIGH?8:0,c=0;8>c;c++)d=this.decodeColor(this.bytes[a+4+2*c],this.bytes[a+5+2*c]),this.colorTable[c+h]=[17*d[0],17*d[1],17*d[2]]}return!0};a.prototype.RGBToHex=function(a,b,c){return a<<16^b<<8^c};a.prototype.clear=function(a){for(var b=0;b<this.HEIGHT;b++)for(var c=0;c<this.WIDTH;c++)this.pixelColorIndex[b*this.WIDTH+c]=a};a.prototype.decodeColor=function(a,f){return[(a&b.u8[this.SC_MASK])>>2,(a&3)<<2|f>>4&3,f&15]};return a}();f.CDGDisplay=k})(nid||(nid={}));
